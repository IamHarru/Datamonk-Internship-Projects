<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <title>google.drive</title>

</head>

<body>
    <nav>
        <div class="d_">
            <div class="svg_contain"><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100"
                    viewBox="0 0 48 48">
                    <path fill="#1e88e5"
                        d="M38.59,39c-0.535,0.93-0.298,1.68-1.195,2.197C36.498,41.715,35.465,42,34.39,42H13.61 c-1.074,0-2.106-0.285-3.004-0.802C9.708,40.681,9.945,39.93,9.41,39l7.67-9h13.84L38.59,39z">
                    </path>
                    <path fill="#fbc02d"
                        d="M27.463,6.999c1.073-0.002,2.104-0.716,3.001-0.198c0.897,0.519,1.66,1.27,2.197,2.201l10.39,17.996 c0.537,0.93,0.807,1.967,0.808,3.002c0.001,1.037-1.267,2.073-1.806,3.001l-11.127-3.005l-6.924-11.993L27.463,6.999z">
                    </path>
                    <path fill="#e53935"
                        d="M43.86,30c0,1.04-0.27,2.07-0.81,3l-3.67,6.35c-0.53,0.78-1.21,1.4-1.99,1.85L30.92,30H43.86z">
                    </path>
                    <path fill="#4caf50"
                        d="M5.947,33.001c-0.538-0.928-1.806-1.964-1.806-3c0.001-1.036,0.27-2.073,0.808-3.004l10.39-17.996 c0.537-0.93,1.3-1.682,2.196-2.2c0.897-0.519,1.929,0.195,3.002,0.197l3.459,11.009l-6.922,11.989L5.947,33.001z">
                    </path>
                    <path fill="#1565c0"
                        d="M17.08,30l-6.47,11.2c-0.78-0.45-1.46-1.07-1.99-1.85L4.95,33c-0.54-0.93-0.81-1.96-0.81-3H17.08z">
                    </path>
                    <path fill="#2e7d32"
                        d="M30.46,6.8L24,18L17.53,6.8c0.78-0.45,1.66-0.73,2.6-0.79L27.46,6C28.54,6,29.57,6.28,30.46,6.8z">
                    </path>
                </svg>
            </div>
            <div>
                <h1>Drive</h1>
            </div>
            <div class="s_b"  title="not working"><button class="search-button">üîç</button><input type="text" placeholder="Search in Drive "
                    class="search-input" /> </div>
            <div class="nav_but">
                <ul class="nav_but_parent">
                    <li><a href=""><svg width="32" height="32" viewBox="0 0 32 32">
                                <circle cx="16" cy="16" r="15" fill="none" stroke="#444" stroke-width="2" />
                                <path d="M10 17l4 4 8-8" fill="none" stroke="#444" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg></a></li>
                    <li><a href=""><svg width="32" height="32" viewBox="0 0 32 32">
                                <circle cx="16" cy="16" r="15" fill="none" stroke="#444" stroke-width="2" />
                                <path d="M16 22v-2" stroke="#444" stroke-width="2" stroke-linecap="round" />
                                <path d="M16 18c0-2 3-2 3-5a3 3 0 1 0-6 0" fill="none" stroke="#444" stroke-width="2"
                                    stroke-linecap="round" />
                            </svg></a></li>
                    <li><a href=""><svg width="32" height="32" viewBox="0 0 32 32">
                                <circle cx="16" cy="16" r="4" fill="none" stroke="#444" stroke-width="2" />
                                <g stroke="#444" stroke-width="2">
                                    <path d="M16 4v4" />
                                    <path d="M16 24v4" />
                                    <path d="M4 16h4" />
                                    <path d="M24 16h4" />
                                    <path d="M7.8 7.8l2.8 2.8" />
                                    <path d="M21.4 21.4l2.8 2.8" />
                                    <path d="M7.8 24.2l2.8-2.8" />
                                    <path d="M21.4 10.6l2.8-2.8" />
                                </g>
                            </svg>
                        </a></li>
                    <li><svg width="32" height="32" viewBox="0 0 32 32">
                            <g fill="#444">
                                <circle cx="8" cy="8" r="2" />
                                <circle cx="16" cy="8" r="2" />
                                <circle cx="24" cy="8" r="2" />
                                <circle cx="8" cy="16" r="2" />
                                <circle cx="16" cy="16" r="2" />
                                <circle cx="24" cy="16" r="2" />
                                <circle cx="8" cy="24" r="2" />
                                <circle cx="16" cy="24" r="2" />
                                <circle cx="24" cy="24" r="2" />
                            </g>
                        </svg></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <aside class="main_aside">
            <section class="parent_aside">
                <!-- upload section -->
                <section class="one_aside">
                    <div class="s_o_d">
                        <div class="u_h_i"> <img src="upload_icon.png" alt="">
                            <h2>Upload a File</h2>
                        </div>

                        <input type="file" id="fileInput" />
                        <button onclick="uploadFile()">Upload</button>
                    </div>
                </section>
                <!-- delete section -->
                <section class="one_aside">
                    <div class="s_o_d">
                        <div class="u_h_i">
                            <h2>Delete a File</h2>
                            <img src="garbage.png" alt="">
                        </div>
                        <input type="text" id="deleteInput" placeholder="Enter filename (e.g., test.pdf)" />
                        <button onclick="deleteFile()">Delete</button>
                    </div>
                </section>
                <!-- right now  It's not working. just for display -->
            </section>
            <section class="five_aside">
                <div class="storage_bar">
                    <div class="bar"></div>
                </div>

                <div class="storage_text">
                    <h2>2.02 GB of 15 GB used</h2>
                </div>

            </section>
            </section>
        </aside>
        <main class="parent_main">

            <!-- Uploads Section Start -->
            <!-- because of this we can see the list of uploads in the drive -->

            <section class="uploads_section">
                <div>
                    <h2>Uploaded Files</h2>
                </div>
                <section class="main_content u_s_nav">
                    <div>
                        <h2>Type</h2>
                        <h2>Name</h2>
                    </div>
                </section>
                <div id="fileList" class="uploads_grid"></div>
            </section>


        </main>

    </div>


    <script>
        const SERVER = 'http://localhost:5000';

        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) return alert("No file selected.");

            const formData = new FormData();
            formData.append('file', file);

            try {
                const res = await fetch(`${SERVER}/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (!res.ok) {
                    const errorText = await res.text();
                    throw new Error(errorText || 'Unknown error');
                }

                const data = await res.json();
                alert(data.message);
                loadFiles(); // refresh UI
            } catch (err) {
                console.error("Upload error:", err);
                alert("Upload failed: " + err.message);
            }
        }

        async function deleteFile() {
            const filename = document.getElementById('deleteInput').value.trim();
            if (!filename) return alert("Enter a filename to delete.");

            try {
                const res = await fetch(`${SERVER}/delete/${filename}`, {
                    method: 'DELETE'
                });
                const data = await res.json();
                alert(data.message);
                loadFiles(); // Refresh file list after delete
            } catch (err) {
                console.error(err);
                alert("Delete failed.");
            }
        }
        function getFileIcon(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            switch (ext) {
                case 'pdf': return `üìÑ`;
                case 'doc':
                case 'docx': return `üìù`;
                case 'xls':
                case 'xlsx': return `üìä`;
                case 'jpg':
                case 'jpeg':
                case 'png': return `üñºÔ∏è`;
                case 'mp3': return `üéµ `;
                case 'mp4': return `üé•`;
                default: return `üìÅ`; // Default icon for unknown file types
            }
        }
async function loadFiles() {
    const res = await fetch(`${SERVER}/dbfiles`);
    const files = await res.json();

    const fileList = document.getElementById('fileList');
    fileList.innerHTML = '';

    files.forEach(file => {
        const item = document.createElement('div');
        item.className = 'upload_item';

        const iconPath = getFileIcon(file.name);

        item.innerHTML = `
            <span style="font-size: 24px; margin-right: 8px;">${iconPath}</span>
            <span>${file.name}</span>
            <div>
                <a href="${SERVER}/uploads/${file.name}" target="_blank">Open</a> |
                <a href="${SERVER}/download/${file.name}">Download</a>
            </div>
        `;

        fileList.appendChild(item);
    });
}


        // Load files on page load
        window.onload = () => {
            loadFiles();
        };
    </script>
</body>

</html>